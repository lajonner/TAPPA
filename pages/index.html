<!DOCTYPE html>
<html>
  <head>   
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="description" content="">
        <meta name="author" content="">
        <link href="../bower_components/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
        <link href="../bower_components/metisMenu/dist/metisMenu.min.css" rel="stylesheet">
        <link href="../dist/css/timeline.css" rel="stylesheet">
        <link href="../dist/css/sb-admin-2.css" rel="stylesheet">
        <link href="../bower_components/morrisjs/morris.css" rel="stylesheet">
        <link href="../bower_components/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
        <script type="text/javascript" charset="utf-8" src="../js/jquery.min.js"></script>
        <script type="text/javascript" charset="utf-8" src="../js/cordova-2.2.0.js"></script>
        <script type<script type="text/javascript" charset="utf-8" src="../js/db.js"></script>
        <script type<script type="text/javascript" charset="utf-8" src="../js/main.js"></script>
        <script type="text/javascript" charset="utf-8" src="../js/activityController.js"></script>
        <script type="text/javascript" charset="utf-8"> </script>
        <script>
          var categoryId=0;
          var indexId=1;
          function openActivity(pageName) {
            var newWindow = location.href=pageName;
            return newWindow;
          };     
               
          function searchLoadPictogramLimit(){
            var optionValue = document.getElementById("cboOption").value;
            var divPictograms = document.getElementById("pictogramList");
            divPictograms.innerHTML="";
            var txtSearchValue = document.getElementById("txtSearch").value;
            if (optionValue=='Pictogramas'){
              loadPictogramByName(dbObject,txtSearchValue,indexId);  
              document.close();               
            }
            if (optionValue=='Preferencias'){
              loadPreferences(dbObject,txtSearchValue);  
              document.close();               
            }
          };
          function allowDrop(ev) {
            ev.preventDefault();
          };
          function drag(ev) {
              ev.dataTransfer.setData("text", ev.target.id);
          };
          function drop(ev) {      
          if (ev.target.id=="pictogramResult"){
                ev.preventDefault();
                var data = ev.dataTransfer.getData("text");                              
                if(data.startsWith("img_")){
                  ev.target.appendChild(loadImagePictogram(data));
                }else{  
                   ev.target.appendChild(copyPhrase(data));
                }
          }};
          function clearResult(){
           var divPictograms = document.getElementById("pictogramResult");
           divPictograms.innerHTML="";
           document.close();
           cancelPreference();
          }
          function addPhrase(){
           var txtPictogram = document.getElementById("txtSearch").value;
           if (txtPictogram.length<=0){
            alert("Frase o palabra.No puede estar vacia.");
            return false;
           }
           if (txtPictogram.trim().length<=0){
            alert("Frase o palabra.No puede contener solo espacios en blanco.");
            return false;
           }
        var divPictograms = document.getElementById("pictogramResult");       
        var divContainer = document.createElement("div");
            divContainer.setAttribute("id","phrase_"+indexId);
            divContainer.setAttribute("style","float:left; width:10.0%;");
            divContainer.setAttribute("draggable","true");
            var innerHtmlBody='<b/><label id="label_phrase_'+indexId+'"  ondragstart="drag(event)" draggable="true">'+txtPictogram+'</label></b>';
            divContainer.innerHTML=innerHtmlBody;
            divPictograms.appendChild(divContainer);
            indexId=indexId+1;
            return true;
          }
          function savePreferences(){
            var bodyPictogram = document.getElementById("pictogramResult");  
            if (bodyPictogram.childNodes.length<=0){
              alert("Deb existir al menos dos pictogramas o frases relacionados");
              return false;
            }
            if (!isValidateFields()){
              return false;
            }
            var txtName = document.getElementById("fld_name");    
            var txtCode= document.getElementById("fld_code");    
            var listValues=[];
            var sequence=1;
            for(var x=0;x<bodyPictogram.childNodes.length-1;x++) {
                var divx = bodyPictogram.children[x];
                var eachValues=[null,null,0];
                if(divx.tagName=="DIV"){
                  if(divx.id.startsWith("result_img")){
                      var divPictogramResult = document.getElementById(divx.id);
                      var divxid_part=(divx.id).split("result_img_");      
                      var lblImg = document.getElementById("lbl_img_"+divxid_part[1]);
                      eachValues[0]=divxid_part[1];
                       eachValues[1]=lblImg.innerHTML;
                  }else{
                      var divPhraseResult = document.getElementById(divx.id);
                      var divxid_part=(divx.id).split("phrase_");
                      var bPhrase = document.getElementById("label_phrase_"+divxid_part[1]);
                     eachValues[1]=bPhrase.innerHTML;
                  }
                  eachValues[2]=sequence
                  listValues.push(eachValues);
                }
                sequence=sequence+1;
              }            
            var code=txtCode.value;            
            var name=txtName.value;
            savePreferencesRecord(dbObject,listValues,code,name)
            cancelPreference();
            return true;
          }
          function isValidateFields(){
            var bodyPictogram = document.getElementById("pictogramResult");  
             var fld_name = document.getElementById("fld_name");    
              var fld_code= document.getElementById("fld_code");   
           var name = fld_name.value;
            var code = fld_code.value;
              if (name==null){
                 alert("Campo Nombre no puede estar vacio.VERIFIQUE!");
                fld_name.focus();
                 return false;
              }
              if (name.trim().length<=0){
                 alert("Campo Nombre no puede contener solo espacios en blanco.VERIFIQUE!");
                 fld_name.focus();
                 return false;
              }
              if (code==null){
                 alert("Campo Código no puede estar vacio.VERIFIQUE!");
                fld_code.focus();
                 return false;
              }
              if (code.trim().length<=0){
                 alert("Campo Código no puede contener solo espacios en blanco.VERIFIQUE!");
                 fldcode.focus();
                 return false;
              }
              return true;
          }
          function openPreferenceForm(){
           var $divResult = $('#pictogramResult');
          var count = $divResult[0].childElementCount;
          if(count<=0){
            alert("Debe existir al menos dos Pictogramas o frases relacionados.");
            return false;
          }
          $("#preferenceForm").show(); 
          clearPreferenceForm();   
          var bodyPictogram = document.getElementById("pictogramResult");          
          var allPhrase="";
          if (bodyPictogram.childNodes.length>0){
            for(var x=0;x<bodyPictogram.childNodes.length-1;x++) {
                var divx = bodyPictogram.children[x];
                if(divx.tagName=="DIV"){
                  if(divx.id.startsWith("result_img")){
                      var divPictogramResult = document.getElementById(divx.id);
                      var divxid_part=(divx.id).split("result_img_");      
                      var lblImg = document.getElementById("lbl_img_"+divxid_part[1]);
                      allPhrase+=" "+lblImg.innerHTML;
                  }else{
                      var divPhraseResult = document.getElementById(divx.id);
                      var divxid_part=(divx.id).split("phrase_");
                      var bPhrase = document.getElementById("label_phrase_"+divxid_part[1]);
                      allPhrase+=" "+bPhrase.innerHTML;
                  }
                }
              }
            }
            var txtName = document.getElementById("fld_name");    
              txtName.value=allPhrase;
          }        
          function cancelPreference(){
           $("#preferenceForm").hide(); 
          clearPreferenceForm();
          }
          function clearPreferenceForm(){
            var txtName = document.getElementById("fld_name");    
             var txtCode = document.getElementById("fld_code");   
             txtName.value=null;
              txtCode.value=null;
          }
           function showAbout() {
            alert('TAPPA\nTecnología Aplicada para personas con problemas Auditivos\nAutores:\nLajonner Alfonso Crespín Moran\nMónica Elizabeth Chavez Estrada');
          }
         </script>
  </head>
  <body>
      <div id="wrapper">
        <nav class="navbar navbar-default navbar-static-top" role="navigation" style="margin-bottom: 0">
            <div class="navbar-header">                
                <a class="navbar-brand" href="index.html">TAPPA</a>
            </div>
            <ul class="nav navbar-top-links navbar-right">         
                                                               
            </ul>         
            <div class="navbar-default sidebar" role="navigation">
                <div class="sidebar-nav navbar-collapse">
                    <ul class="nav" id="side-menu">
                       
                         <li>
                            <a href="#"><i class="fa fa-sitemap fa-fw"></i>Categoría<span class="fa arrow"></span></a>
                            <ul class="nav nav-second-level" id="categoryPictogramList">
                                                              
                            </ul>
                        </li>
                        <li class="active">
                            <a href="#"><i class="fa fa-files-o fa-fw"></i>Menú<span class="fa arrow"></span></a>
                            <ul class="nav nav-second-level collapse in" aria-expanded="true">
                              <li>
                                <li class="active"><a href="#" data-value="action_1" id="option_category" onclick="openActivity('activitySearch_categoryPictogram.html')">Categorías<span class="fa fa-sitemap fa-fw"></span></a></li>
                                 <li class="active"><a href="#" data-value="action_2" id="option_pictogram" onclick="openActivity('activitySearch_Pictogram.html')">Pictogramas<span class="fa  fa-image"></span></a></li>
                                 <li class="active"><a  href="#" data-value="action_3" id="option_preference" onclick="openPreferenceForm()">Grabar Preferencias<span class="fa fa-flash"></span></a></li>
                                 <li class="active"><a href="#" data-value="action_4" id="option_show_about" onclick="showAbout()">Acerca<span class="fa fa-info-circle"></span></a></li>    
                               </li>
                            </ul>
                        </li>


                    </ul>
                </div>
            </div>
        </nav>

        <div id="page-wrapper">
          <br/>
            <div class="row">
                <div class="col-lg-12">                        
                   <div class="input-group custom-search-form" align="right">    
                      <span class="input-group-btn" style="width:25%">
                                <select class="form-control" onchange="searchLoadPictogramLimit()" id="cboOption">
                                        <option data-value="pictogram">Pictogramas</option>
                                        <option data-value="preference">Preferencias</option>                              
                                </select>
                              </span>
                                <input id="txtSearch" type="text" class="form-control" placeholder="Buscar...">                             
                                <span class="input-group-btn">
                                <button class="btn btn-default" type="button" id="btnSearch" onclick="searchLoadPictogramLimit()">
                                    <i class="fa fa-search"></i>
                                </button>
                            </span>     
                                <input type="number" name="quantity" min="1"  id="limitRecords" class="form-control" style="width:25%" onkeypress="searchLoadPictogramLimit()" onclick="searchLoadPictogramLimit()">      
                            </div>
                  </div>  
                  <br/>
                  <br/>
                   <br/>
            </div>
             <div id="pictogramList"  class="row">
         <!--pitogramas-->
    </div>
<br/>
    <div class="row">
      <div class="col-lg-12"> 
   
   
<div class="row">
 <button class="btn btn-default" type="button" id="btnClear" onclick="clearResult()">
                                    <i class="fa fa-trash-o"></i>
                                Limpiar</button> <button class="btn btn-default" type="button" id="btnAddPhrase" onclick="addPhrase()">
                                    <i class="fa fa-paste"></i>
                                Copiar</button>
 <div id="pictogramResult"  class="panel-body" ondrop="drop(event)" ondragover="allowDrop(event)"  float="none" style="border:solid;border-color: #ddd"> </div>

    </div>
  </div>
  </div>
<br/>
<div class="row" id="preferenceForm">
      <div class="col-lg-6"> 
        <div class="panel panel-default">
  <div class="panel-heading">
                            Preferencia
                        </div>
   
<div class="panel-body">
    <div class="form-group">
                                            <label>Código</label>
                                            <input class="form-control" id="fld_code">
                                            <p class="help-block">Código de busqueda</p>
                                            <label>Frase</label>
                                            <input class="form-control" id="fld_name">
                                            <p class="help-block">Frase completa</p>
                                        </div>  
                                        <button class="btn btn-default" type="button"  onclick="savePreferences()" >Grabar<i class="fa fa-save"></i></button>
                                        
                                        <button class="btn btn-default" type="button"  onclick="cancelPreference()">Cancelar<i class="fa fa-ban"></i></button>

 </div>  
</div>
  </div>
  </div>
       
      </div>       
        </div>
     <script src="../bower_components/jquery/dist/jquery.min.js"></script>
     <script src="../bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
      <script src="../bower_components/metisMenu/dist/metisMenu.min.js"></script>
    <script src="../bower_components/raphael/raphael-min.js"></script>
    <script src="../bower_components/morrisjs/morris.min.js"></script>
    <script src="../dist/js/sb-admin-2.js"></script>
      <script>
        document.getElementById("limitRecords").value=10;
        loadCategoryPictogramList(dbObject);
        var vars=getVars(document);
        categoryId=0;
        if (vars.hasOwnProperty("id")){
          categoryId=Number(vars["id"]);         
        }
        loadPictogramByCategoryId(dbObject,categoryId);
        cancelPreference();
      </script>
  </body>
</html>